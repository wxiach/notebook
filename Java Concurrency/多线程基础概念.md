## 什么是线程和进程

进程可以是操作系统中正在运行的应用程序。一个进程由多个线程组成，一个应用程序可以由一个进程或者多个进程组成。

在windows下，可以通过任务管理器查看某个应用程序的进程和线程数量，也可以通过命令行查看：

```bash
tasklist | findstr chrome
```

## 理解线程调度

对于操作系统来说，进程是资源分配的基本单位，线程是调度和执行的基本单位。

CPU从一个线程切换到另外一个线程的过程被成为调度，做这个工作的组件叫做调度器，他会把当前线程的上下文（程序计数器，寄存器状态）保存下来，再切换到另外一个线程的上下文。

## 区分并发和并行

对于单核CPU来说，如果有多个线程，调度器会为每个线程分配时间片，让这些线程轮流执行，这种能力叫并发。对于多核CPU来说，如果有多个线程，调度器会让多个线程在同一时刻同时运行，这种能力叫并行。

并发和并行是可以同时存在的。

## 栈与栈帧

栈是线程私有的内存区域，每个线程在创建时都会被分配一个独立的栈空间。栈帧是栈中一段动态内存块，代表单个函数调用的上下文，一个线程可能包含多个栈帧（嵌套调用时）。

## 守护进程

默认情况下，Java进程需要等待所有线程执行结束后才会结束。但守护线程例外，它是一种特殊的线程，只要其他非守护线程都运行结束了，即使它没有执行完也会被强制结束。

在Java中可以通过以下方式将一个线程设置为守护线程：

```java
t1.setDaemon(true)
```

常见的守护线程

- Java中的垃圾回收线程
- Tomcat中的Acceptor和Poller线程

## 线程的状态

操作系统层面，把线程划分为了五个状态： 创建、就绪、运行中、阻塞、终止。

在Java中，把线程划分为了六个状态，他们被定义在了Thread内部的一个枚举类里面：

```java
public static enum State {
    NEW,
    RUNNABLE,
    BLOCKED,
    WAITING,
    TIMED_WAITING,
    TERMINATED;

    private State() {
    }
}
```

需要注意的是，RUNNABLE既代表操作系统中线程的就绪态也代表运行态。WAITING，TIMED_WATING，BLOCKED都代表操作系统中线程的阻塞状态。
