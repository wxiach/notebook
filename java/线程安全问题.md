# 线程安全问题

多个线程对共享资源读写操作时发生指令交错，就会产生线程安全问题。

```Java
public class Test {
    static int count = 0; // 静态变量，存放在主内存

    public static void main(String[] args) {
        new Thread(() -> {
            for (int i = 0; i < 1000; i++) {
                count++; // 操作的是Thread-A工作内存中的副本
            }
        }).start();

        new Thread(() -> {
            for (int i = 0; i < 1000; i++) {
                count++; // 操作的是Thread-B工作内存中的副本
            }
        }).start();
    }
}
```

在Java中线程如果要完成对共享变量的操作，需要进行主内存和工作内存的数据交换。JMM规定了一系列步骤来完成这个同步工作，但这个过程不是原子的，所以会产生指令交错问题。

比如上面的例子，最终得到的结果不一定是2000，有可能A线程自增的结果还没有同步到主内存，B线程就已经开始了下一次自增操作，最终导致A线程覆盖B线程的结果。
