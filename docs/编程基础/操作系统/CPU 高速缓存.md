# CPU 高速缓存

CPU 高速缓存是 CPU 内部的一块小型存储器，用于存储 CPU 最近使用的数据和指令。它的访问速度比内存快得多，通常是内存的几倍到几十倍。

![CPU 多级缓存架构原理](/images/CPU%20多级缓存架构原理.png)

CPU 高速缓存分为 L1、L2 和 L3 三级，其中 L1 是最快的，L3 是最大的。L3 缓存通常是共享的，而 L1 和 L2 缓存是每个核心独立的。

> 缓存的工作原理基于**局部性原理**。

## 为什么需要高速缓存

CPU 执行指令时需与内存交换数据。由于内存速度远慢于 CPU，引入高速缓存以存储常用数据，减少 CPU 等待时间，提升性能。

如果说内存（主存储器，RAM）是外存（辅助存储器，硬盘/SSD）的高速缓存，那么 CPU 高速缓存就可以被形象的称为 **「内存的内存」**。

## 缓存一致性问题

多核 CPU 中，各核心缓存数据需保持一致。若一核心修改数据，其他核心缓存也须更新。

> 例如，两线程在不同 CPU 缓存中对变量 `i`（初值为 1）执行 `i++`。并发下，`i` 可能变为 2 而非预期的 3，此即缓存一致性问题。

为保证数据一致，现代 CPU 采用**缓存一致性协议**（如 MESI）。该协议通过标记缓存行状态，在某 CPU 修改共享数据时，通知其他 CPU 使其缓存失效，迫使其下次从主内存重读最新值。
